# 🏗️ Архитектура системы

## Общая схема

```
┌─────────────────────────────────────────────────────────────┐
│                         FRONTEND                             │
│                      (ai-checker-backend.js)                 │
│                                                              │
│  ┌──────────────┐    ┌──────────────┐    ┌──────────────┐  │
│  │   Ввод текста│ -> │  Валидация   │ -> │   Отправка   │  │
│  │              │    │              │    │   на backend │  │
│  └──────────────┘    └──────────────┘    └──────────────┘  │
│                                                 │            │
└─────────────────────────────────────────────────┼────────────┘
                                                  │
                                                  │ HTTP POST
                                                  │ /api/analyze
                                                  ▼
┌─────────────────────────────────────────────────────────────┐
│                         BACKEND                              │
│                        (Flask API)                           │
│                                                              │
│  ┌──────────────────────────────────────────────────────┐  │
│  │                    app.py                             │  │
│  │                                                       │  │
│  │  ┌─────────────────┐      ┌─────────────────┐       │  │
│  │  │  Структурный    │      │  Нейросетевой   │       │  │
│  │  │    анализ       │      │     анализ      │       │  │
│  │  │                 │      │                 │       │  │
│  │  │ • Предложения   │      │ • RuBERT-tiny2  │       │  │
│  │  │ • Слова         │      │ • Качество      │       │  │
│  │  │ • Прилагательные│      │ • Токсичность   │       │  │
│  │  └────────┬────────┘      └────────┬────────┘       │  │
│  │           │                        │                │  │
│  │           └────────┬───────────────┘                │  │
│  │                    ▼                                │  │
│  │           ┌─────────────────┐                       │  │
│  │           │ Комбинированная │                       │  │
│  │           │     оценка      │                       │  │
│  │           └─────────────────┘                       │  │
│  └──────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────┘
                                │
                                │ JSON Response
                                ▼
┌─────────────────────────────────────────────────────────────┐
│                    ОТОБРАЖЕНИЕ РЕЗУЛЬТАТА                    │
│                                                              │
│  ┌──────────────┐    ┌──────────────┐    ┌──────────────┐  │
│  │   Оценка     │    │   Структура  │    │  Нейросеть   │  │
│  │   0-100      │    │   Feedback   │    │   Анализ     │  │
│  └──────────────┘    └──────────────┘    └──────────────┘  │
└─────────────────────────────────────────────────────────────┘
```

## Детальная архитектура нейросети

```
Входной текст: "Карл - добрый хомлин..."
        │
        ▼
┌─────────────────────────────────────────┐
│         Токенизация (RuBERT)            │
│  "Карл" -> [101, 2345, 102, ...]        │
└─────────────────┬───────────────────────┘
                  │
                  ▼
┌─────────────────────────────────────────┐
│      RuBERT-tiny2 Encoder               │
│  312-мерное векторное представление     │
│                                         │
│  [0.23, -0.45, 0.67, ..., 0.12]        │
└─────────────────┬───────────────────────┘
                  │
        ┌─────────┴─────────┐
        │                   │
        ▼                   ▼
┌──────────────┐    ┌──────────────┐
│ Голова       │    │ Голова       │
│ качества     │    │ токсичности  │
│              │    │              │
│ Linear(312,1)│    │ Linear(312,1)│
│ + Sigmoid    │    │ + Sigmoid    │
└──────┬───────┘    └──────┬───────┘
       │                   │
       ▼                   ▼
   Quality Score      Toxicity Score
     (0-100)             (0-100)
```

## Поток данных

### 1. Пользователь вводит текст
```javascript
{
  text: "Карл - добрый хомлин...",
  character: "Карл"
}
```

### 2. Frontend отправляет на backend
```http
POST http://localhost:5000/api/analyze
Content-Type: application/json

{
  "text": "Карл - добрый хомлин...",
  "character": "Карл"
}
```

### 3. Backend обрабатывает

#### 3.1 Структурный анализ
```python
sentences = split_sentences(text)  # 3 предложения
words = split_words(text)          # 25 слов
descriptive = find_adjectives(text) # найдено
score = calculate_structure_score() # 65/100
```

#### 3.2 Нейросетевой анализ
```python
tokens = tokenizer(text)           # токенизация
embeddings = bert(tokens)          # векторы
quality = quality_head(embeddings) # 85.3
toxicity = toxicity_head(embeddings) # 2.1
```

#### 3.3 Комбинирование
```python
final_score = (structure_score + neural_quality) / 2
# (65 + 85.3) / 2 = 75.15 ≈ 75
```

### 4. Backend возвращает результат
```json
{
  "score": 75,
  "structure": {
    "score": 65,
    "feedback": [...]
  },
  "neural": {
    "quality_score": 85.3,
    "toxicity_score": 2.1,
    "is_appropriate": true
  }
}
```

### 5. Frontend отображает
```
┌─────────────────────────────────┐
│  ⚠️ Оценка: 75/100              │
│                                 │
│  📊 Структурный анализ:         │
│  • ⚠ Мало предложений (3)       │
│  • ✓ Есть прилагательные        │
│  • ⚠ Мало слов (25)             │
│                                 │
│  🤖 Нейросетевой анализ:        │
│  • Качество: 85%                │
│  • Токсичность: 2%              │
│  • ✓ Текст соответствует нормам │
└─────────────────────────────────┘
```

## Технологический стек

### Backend
- **Python 3.8+** - язык программирования
- **Flask** - веб-фреймворк
- **PyTorch** - фреймворк для нейросетей
- **Transformers** - библиотека для работы с BERT
- **Flask-CORS** - поддержка CORS

### Frontend
- **JavaScript (ES6+)** - язык программирования
- **Fetch API** - HTTP запросы
- **HTML5** - разметка
- **CSS3** - стилизация

### Нейросеть
- **RuBERT-tiny2** - предобученная модель
- **312 параметров** - размер эмбеддингов
- **2 головы** - качество и токсичность
- **Sigmoid активация** - выход 0-1

## Производительность

### Время обработки
- Первый запрос: ~3-5 секунд (загрузка модели)
- Последующие: ~0.5-1 секунда

### Требования к памяти
- Модель: ~50MB
- Runtime: ~200MB
- Всего: ~250MB RAM

### Масштабируемость
- Поддержка concurrent запросов
- Кэширование модели
- Batch processing (опционально)

## Безопасность

✅ CORS настроен
✅ Валидация входных данных
✅ Ограничение размера текста (512 токенов)
✅ Нет хранения персональных данных
✅ Локальная обработка (опционально)
